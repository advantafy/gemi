<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸš¢ Gemi Takip â€” CanlÄ±</title>
<link rel="icon" href="data:,">
<style>
  :root {
    --navy: #0a0e1a; --deep: #0d1526; --panel: #111827;
    --border: #1e2d45; --accent: #00d4ff; --accent2: #0088cc;
    --gold: #f0a500; --green: #00e676; --red: #ff4444;
    --text: #c8d8f0; --muted: #4a6080;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--navy); color: var(--text); font-family: system-ui, sans-serif; min-height: 100vh; }
  body::before {
    content: ''; position: fixed; inset: 0;
    background: radial-gradient(ellipse at 20% 50%, rgba(0,212,255,0.04) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 20%, rgba(0,136,204,0.06) 0%, transparent 50%);
    pointer-events: none; z-index: 0;
  }
  .container { position: relative; z-index: 1; max-width: 500px; margin: 0 auto; padding: 20px 16px 60px; }

  .header { text-align: center; margin-bottom: 20px; }
  .header .icon { font-size: 2.2rem; display: block; margin-bottom: 6px; animation: float 3s ease-in-out infinite; }
  @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-5px)} }
  .header h1 { font-size: 1.35rem; font-weight: 800; letter-spacing: 2px; color: #fff; text-transform: uppercase; }
  .header p { font-size: 0.63rem; color: var(--muted); letter-spacing: 1px; margin-top: 4px; font-family: monospace, monospace; }
  .live-badge {
    display: inline-flex; align-items: center; gap: 6px;
    background: rgba(0,230,118,0.1); border: 1px solid rgba(0,230,118,0.3);
    border-radius: 20px; padding: 4px 12px; font-size: 0.63rem;
    color: var(--green); font-family: monospace, monospace; margin-top: 8px;
  }
  .live-dot { width: 7px; height: 7px; background: var(--green); border-radius: 50%; animation: blink 1.2s ease-in-out infinite; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.2} }

  .card { background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 18px; margin-bottom: 14px; }
  .card-title { font-size: 0.6rem; letter-spacing: 2px; color: var(--accent); text-transform: uppercase; font-family: monospace, monospace; margin-bottom: 14px; }

  .tab-bar { display: flex; gap: 0; margin-bottom: 16px; background: var(--deep); border-radius: 10px; padding: 3px; }
  .tab-btn { flex: 1; padding: 9px; border: none; border-radius: 8px; font-family: system-ui, sans-serif; font-size: 0.78rem; font-weight: 700; cursor: pointer; background: transparent; color: var(--muted); transition: all 0.2s; }
  .tab-btn.active { background: var(--accent2); color: #fff; }
  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  .field { margin-bottom: 12px; }
  label { display: block; font-size: 0.66rem; color: var(--muted); margin-bottom: 5px; letter-spacing: 1px; text-transform: uppercase; }
  select {
    width: 100%; background: var(--deep); border: 1px solid var(--border); border-radius: 10px;
    color: var(--text); padding: 11px 13px; font-size: 0.86rem;
    font-family: monospace, monospace; outline: none; transition: border-color 0.2s;
    -webkit-appearance: none; appearance: none;
  }
  select:focus { border-color: var(--accent); }
  select option { background: var(--deep); }
  .row { display: flex; gap: 10px; }
  .row .field { flex: 1; }
  .arrow-divider { text-align: center; font-size: 1.4rem; color: var(--accent); margin: 2px 0 10px; }

  .btn {
    width: 100%; padding: 14px; background: linear-gradient(135deg, var(--accent2), var(--accent));
    border: none; border-radius: 12px; color: #000; font-family: system-ui, sans-serif;
    font-size: 0.93rem; font-weight: 800; letter-spacing: 1px; cursor: pointer;
    text-transform: uppercase; transition: all 0.2s; margin-top: 4px;
  }
  .btn:active { transform: scale(0.97); }
  .btn:disabled { opacity: 0.4; cursor: not-allowed; }
  .btn-stop { background: linear-gradient(135deg, #991111, var(--red)); display: none; margin-top: 8px; }

  .conn-bar { display: none; align-items: center; gap: 10px; background: var(--deep); border: 1px solid var(--border); border-radius: 12px; padding: 12px 16px; margin-bottom: 14px; }
  .conn-text { flex: 1; }
  .conn-title { font-size: 0.78rem; color: #fff; font-weight: 700; }
  .conn-sub { font-size: 0.6rem; color: var(--muted); font-family: monospace, monospace; margin-top: 2px; }
  .conn-count { font-size: 1.4rem; font-weight: 800; color: var(--accent); font-family: monospace, monospace; }

  /* LOG - Ã¶nemli hata mesajlarÄ± iÃ§in */
  .log-box {
    display: none; background: var(--deep); border: 1px solid var(--border);
    border-radius: 10px; padding: 10px 12px; font-size: 0.63rem;
    font-family: monospace, monospace; color: var(--muted);
    max-height: 100px; overflow-y: auto; margin-bottom: 14px;
  }
  .log-line { margin-bottom: 3px; }
  .log-line.ok { color: var(--green); }
  .log-line.err { color: var(--red); }
  .log-line.info { color: var(--accent); }
  .log-line.warn { color: var(--gold); }

  .stats-bar { display: none; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
  .stat { flex: 1; min-width: 60px; background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 10px 6px; text-align: center; }
  .stat .num { font-size: 1.3rem; font-weight: 800; color: var(--accent); font-family: monospace, monospace; line-height: 1; }
  .stat .lbl { font-size: 0.54rem; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; margin-top: 3px; }

  .filter-bar { display: none; gap: 6px; margin-bottom: 12px; overflow-x: auto; padding-bottom: 4px; }
  .filter-chip { white-space: nowrap; padding: 5px 13px; border-radius: 20px; font-size: 0.65rem; font-weight: 700; cursor: pointer; border: 1px solid var(--border); color: var(--muted); background: transparent; transition: all 0.15s; font-family: system-ui, sans-serif; }
  .filter-chip.active { background: rgba(0,212,255,0.1); border-color: var(--accent); color: var(--accent); }

  .ship-card {
    background: var(--panel); border: 1px solid var(--border); border-radius: 14px;
    padding: 14px; margin-bottom: 9px; cursor: pointer; transition: border-color 0.2s;
    position: relative; overflow: hidden; animation: slideIn 0.25s ease;
  }
  @keyframes slideIn { from{opacity:0;transform:translateY(6px)} to{opacity:1;transform:translateY(0)} }
  .ship-card::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 3px; background: var(--accent); border-radius: 3px 0 0 3px; }
  .ship-card.yeni::before { background: var(--green); }
  .ship-card.rotada-kart::before { background: var(--gold); }
  .ship-card.expanded { border-color: var(--accent); }
  .ship-top { display: flex; justify-content: space-between; align-items: flex-start; }
  .ship-name { font-size: 0.9rem; font-weight: 700; color: #fff; }
  .ship-mmsi { font-size: 0.62rem; color: var(--accent); font-family: monospace, monospace; margin-top: 2px; }
  .ship-meta { display: flex; gap: 5px; margin-top: 8px; flex-wrap: wrap; }
  .badge { padding: 3px 9px; border-radius: 20px; font-size: 0.57rem; font-weight: 700; text-transform: uppercase; }
  .badge-bulk { background: rgba(0,212,255,0.1); color: var(--accent); border: 1px solid rgba(0,212,255,0.2); }
  .badge-move { background: rgba(0,230,118,0.1); color: var(--green); border: 1px solid rgba(0,230,118,0.2); }
  .badge-stop { background: rgba(240,165,0,0.1); color: var(--gold); border: 1px solid rgba(240,165,0,0.2); }
  .badge-new { background: rgba(0,230,118,0.15); color: var(--green); border: 1px solid rgba(0,230,118,0.3); }
  .badge-rotada { background: rgba(240,165,0,0.15); color: var(--gold); border: 1px solid rgba(240,165,0,0.3); }

  .route-display { display: flex; align-items: center; gap: 6px; background: var(--deep); border-radius: 8px; padding: 8px 11px; margin-top: 8px; font-size: 0.67rem; font-family: monospace, monospace; }
  .route-display .port { color: #fff; flex: 1; }
  .route-display .arrow { color: var(--accent); }

  .ship-details { display: none; margin-top: 11px; padding-top: 11px; border-top: 1px solid var(--border); }
  .ship-card.expanded .ship-details { display: block; }
  .detail-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid rgba(30,45,69,0.4); }
  .detail-row:last-child { border-bottom: none; }
  .detail-key { font-size: 0.59rem; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }
  .detail-val { font-size: 0.72rem; color: var(--text); font-family: monospace, monospace; text-align: right; max-width: 65%; }
  .detail-link { color: var(--accent) !important; cursor: pointer; }

  .empty-state { text-align: center; padding: 40px 20px; color: var(--muted); font-size: 0.78rem; font-family: monospace, monospace; line-height: 2.2; }
  .empty-state .big { font-size: 2.5rem; display: block; margin-bottom: 10px; }

  .footer { text-align: center; margin-top: 30px; font-size: 0.58rem; color: var(--muted); font-family: monospace, monospace; line-height: 2; }
  ::-webkit-scrollbar { width: 4px; height: 4px; }
  ::-webkit-scrollbar-track { background: var(--deep); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
</style>
</head>
<body>
<div class="container">

  <div class="header">
    <span class="icon">ğŸš¢</span>
    <h1>Gemi Takip</h1>
    <p>GERÃ‡EK ZAMANLI Â· AISStream.io</p>
    <div class="live-badge"><div class="live-dot"></div>CANLI VERÄ°</div>
  </div>

  <div class="card">
    <div class="card-title">â–¸ Rota SeÃ§imi</div>

    <div class="tab-bar">
      <button class="tab-btn active" onclick="tabDegis('ulke',this)">ğŸŒ Ãœlke â†’ Ãœlke</button>
      <button class="tab-btn" onclick="tabDegis('liman',this)">âš“ Liman â†’ Liman</button>
    </div>

    <!-- ÃœLKE MODU -->
    <div class="tab-panel active" id="tab-ulke">
      <div class="field">
        <label>ğŸ›« Ã‡Ä±kÄ±ÅŸ Ãœlkesi</label>
        <select id="cikisUlke">
          <option value="TR">ğŸ‡¹ğŸ‡· TÃ¼rkiye</option>
          <option value="CN">ğŸ‡¨ğŸ‡³ Ã‡in</option>
          <option value="JP">ğŸ‡¯ğŸ‡µ Japonya</option>
          <option value="KR">ğŸ‡°ğŸ‡· GÃ¼ney Kore</option>
          <option value="SG">ğŸ‡¸ğŸ‡¬ Singapur</option>
          <option value="IN">ğŸ‡®ğŸ‡³ Hindistan</option>
          <option value="PK">ğŸ‡µğŸ‡° Pakistan</option>
          <option value="MY">ğŸ‡²ğŸ‡¾ Malezya</option>
          <option value="ID">ğŸ‡®ğŸ‡© Endonezya</option>
          <option value="DE">ğŸ‡©ğŸ‡ª Almanya</option>
          <option value="NL">ğŸ‡³ğŸ‡± Hollanda</option>
          <option value="BE">ğŸ‡§ğŸ‡ª BelÃ§ika</option>
          <option value="GB">ğŸ‡¬ğŸ‡§ Ä°ngiltere</option>
          <option value="IT">ğŸ‡®ğŸ‡¹ Ä°talya</option>
          <option value="GR">ğŸ‡¬ğŸ‡· Yunanistan</option>
          <option value="ES">ğŸ‡ªğŸ‡¸ Ä°spanya</option>
          <option value="FR">ğŸ‡«ğŸ‡· Fransa</option>
          <option value="US">ğŸ‡ºğŸ‡¸ Amerika</option>
          <option value="BR">ğŸ‡§ğŸ‡· Brezilya</option>
          <option value="AU">ğŸ‡¦ğŸ‡º Avustralya</option>
          <option value="EG">ğŸ‡ªğŸ‡¬ MÄ±sÄ±r</option>
          <option value="ZA">ğŸ‡¿ğŸ‡¦ GÃ¼ney Afrika</option>
          <option value="AE">ğŸ‡¦ğŸ‡ª BAE (Dubai)</option>
          <option value="SA">ğŸ‡¸ğŸ‡¦ Suudi Arabistan</option>
          <option value="KW">ğŸ‡°ğŸ‡¼ Kuveyt</option>
          <option value="QA">ğŸ‡¶ğŸ‡¦ Katar</option>
          <option value="OM">ğŸ‡´ğŸ‡² Umman</option>
          <option value="IR">ğŸ‡®ğŸ‡· Ä°ran</option>
          <option value="IQ">ğŸ‡®ğŸ‡¶ Irak</option>
        </select>
      </div>
      <div class="arrow-divider">â†“</div>
      <div class="field">
        <label>ğŸ›¬ VarÄ±ÅŸ Ãœlkesi</label>
        <select id="varisUlke">
          <option value="AE">ğŸ‡¦ğŸ‡ª BAE (Dubai)</option>
          <option value="TR">ğŸ‡¹ğŸ‡· TÃ¼rkiye</option>
          <option value="SA">ğŸ‡¸ğŸ‡¦ Suudi Arabistan</option>
          <option value="CN">ğŸ‡¨ğŸ‡³ Ã‡in</option>
          <option value="JP">ğŸ‡¯ğŸ‡µ Japonya</option>
          <option value="KR">ğŸ‡°ğŸ‡· GÃ¼ney Kore</option>
          <option value="SG">ğŸ‡¸ğŸ‡¬ Singapur</option>
          <option value="IN">ğŸ‡®ğŸ‡³ Hindistan</option>
          <option value="DE">ğŸ‡©ğŸ‡ª Almanya</option>
          <option value="NL">ğŸ‡³ğŸ‡± Hollanda</option>
          <option value="GB">ğŸ‡¬ğŸ‡§ Ä°ngiltere</option>
          <option value="IT">ğŸ‡®ğŸ‡¹ Ä°talya</option>
          <option value="GR">ğŸ‡¬ğŸ‡· Yunanistan</option>
          <option value="US">ğŸ‡ºğŸ‡¸ Amerika</option>
          <option value="AU">ğŸ‡¦ğŸ‡º Avustralya</option>
          <option value="KW">ğŸ‡°ğŸ‡¼ Kuveyt</option>
          <option value="QA">ğŸ‡¶ğŸ‡¦ Katar</option>
          <option value="OM">ğŸ‡´ğŸ‡² Umman</option>
          <option value="EG">ğŸ‡ªğŸ‡¬ MÄ±sÄ±r</option>
        </select>
      </div>
    </div>

    <!-- LÄ°MAN MODU -->
    <div class="tab-panel" id="tab-liman">
      <div class="field">
        <label>ğŸ›« Ã‡Ä±kÄ±ÅŸ LimanÄ±</label>
        <select id="cikisLiman">
          <optgroup label="ğŸ‡¹ğŸ‡· TÃ¼rkiye">
            <option value="TRAMS">Ä°stanbul (AmbarlÄ±)</option>
            <option value="TRMER">Mersin</option>
            <option value="TRALP">Ä°zmir (AliaÄŸa)</option>
            <option value="TRISK">Ä°skenderun</option>
            <option value="TRTBS">Trabzon</option>
          </optgroup>
          <optgroup label="ğŸ‡¨ğŸ‡³ Ã‡in">
            <option value="CNSHA">Shanghai</option>
            <option value="HKHKG">Hong Kong</option>
            <option value="CNTAO">Qingdao</option>
            <option value="CNTSN">Tianjin</option>
            <option value="CNNGB">Ningbo</option>
            <option value="CNSZX">Shenzhen</option>
          </optgroup>
          <optgroup label="ğŸŒ GÃ¼neydoÄŸu Asya">
            <option value="SGSIN">Singapur</option>
            <option value="MYPKG">Port Klang</option>
            <option value="IDJKT">Jakarta</option>
          </optgroup>
          <optgroup label="ğŸ‡®ğŸ‡³ Hindistan">
            <option value="INNSA">Mumbai (JNPT)</option>
            <option value="INMAA">Chennai</option>
            <option value="INMUN">Mundra</option>
          </optgroup>
          <optgroup label="ğŸ‡ªğŸ‡º Avrupa">
            <option value="DEHAM">Hamburg</option>
            <option value="NLRTM">Rotterdam</option>
            <option value="BEANR">Antwerp</option>
            <option value="GRPIR">Piraeus</option>
            <option value="ITGOA">Genova</option>
          </optgroup>
          <optgroup label="ğŸŒ KÃ¶rfez / Orta DoÄŸu">
            <option value="SADMM">Dammam</option>
            <option value="SAJED">Jeddah</option>
            <option value="KWKWI">Kuveyt</option>
            <option value="QAHMD">Hamad Port</option>
          </optgroup>
        </select>
      </div>
      <div class="arrow-divider">â†“</div>
      <div class="field">
        <label>ğŸ›¬ VarÄ±ÅŸ LimanÄ±</label>
        <select id="varisLiman">
          <optgroup label="ğŸ‡¦ğŸ‡ª BAE">
            <option value="AEJEA">Jebel Ali (Dubai)</option>
            <option value="AEAUH">Abu Dhabi</option>
            <option value="AESHJ">Sharjah</option>
          </optgroup>
          <optgroup label="ğŸ‡¹ğŸ‡· TÃ¼rkiye">
            <option value="TRAMS">Ä°stanbul (AmbarlÄ±)</option>
            <option value="TRMER">Mersin</option>
            <option value="TRALP">Ä°zmir</option>
          </optgroup>
          <optgroup label="ğŸ‡¸ğŸ‡¦ ğŸ‡°ğŸ‡¼ ğŸ‡¶ğŸ‡¦ ğŸ‡´ğŸ‡² KÃ¶rfez">
            <option value="SADMM">Dammam</option>
            <option value="SAJED">Jeddah</option>
            <option value="KWKWI">Kuveyt</option>
            <option value="QAHMD">Hamad Port</option>
            <option value="OMSOH">Salalah</option>
          </optgroup>
          <optgroup label="ğŸ‡¨ğŸ‡³ Ã‡in">
            <option value="CNSHA">Shanghai</option>
            <option value="HKHKG">Hong Kong</option>
            <option value="CNTAO">Qingdao</option>
          </optgroup>
          <optgroup label="ğŸ‡ªğŸ‡º Avrupa">
            <option value="DEHAM">Hamburg</option>
            <option value="NLRTM">Rotterdam</option>
            <option value="GRPIR">Piraeus</option>
          </optgroup>
          <optgroup label="ğŸ‡®ğŸ‡³ ğŸ‡µğŸ‡° GÃ¼ney Asya">
            <option value="INNSA">Mumbai</option>
            <option value="PKKAR">Karachi</option>
          </optgroup>
          <optgroup label="ğŸ‡ªğŸ‡¬ ğŸ‡¿ğŸ‡¦ Afrika">
            <option value="EGPSD">Port Said</option>
            <option value="EGALX">Alexandria</option>
            <option value="ZADUR">Durban</option>
          </optgroup>
        </select>
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <div class="field">
        <label>ğŸš¢ Gemi Tipi</label>
        <select id="gemiTipi">
          <option value="bulk">Kuru YÃ¼k</option>
          <option value="tanker">Tanker</option>
          <option value="all">TÃ¼m Kargo</option>
        </select>
      </div>
      <div class="field">
        <label>ğŸ“Š Max Gemi</label>
        <select id="maxGemi">
          <option value="50">50</option>
          <option value="100" selected>100</option>
          <option value="200">200</option>
        </select>
      </div>
    </div>

    <button class="btn" onclick="baglan()" id="baglanBtn">ğŸ“¡ &nbsp;CANLI BAÄLANTI BAÅLAT</button>
    <button class="btn btn-stop" onclick="baglantiKes()" id="kesBtn">â›” &nbsp;BAÄLANTIYI KES</button>
  </div>

  <!-- BAÄLANTI DURUMU -->
  <div class="conn-bar" id="connBar">
    <div style="font-size:1.1rem">ğŸ“¡</div>
    <div class="conn-text">
      <div class="conn-title" id="connTitle">BaÄŸlanÄ±yor...</div>
      <div class="conn-sub" id="connSub">AISStream.io WebSocket</div>
    </div>
    <div class="conn-count" id="connCount">0</div>
  </div>

  <!-- LOG -->
  <div class="log-box" id="logBox"></div>

  <!-- Ä°STATÄ°STÄ°K -->
  <div class="stats-bar" id="statsBar">
    <div class="stat"><div class="num" id="toplamSayi">0</div><div class="lbl">Toplam</div></div>
    <div class="stat"><div class="num" id="hareketSayi">0</div><div class="lbl">Hareket</div></div>
    <div class="stat"><div class="num" id="durgunSayi">0</div><div class="lbl">Demirli</div></div>
    <div class="stat"><div class="num" id="rotadaSayi">0</div><div class="lbl">ğŸ¯ Rotada</div></div>
  </div>

  <!-- FÄ°LTRE -->
  <div class="filter-bar" id="filterBar">
    <button class="filter-chip active" onclick="filtrele('all',this)">ğŸŒ TÃ¼mÃ¼</button>
    <button class="filter-chip" onclick="filtrele('underway',this)">âš¡ Hareket</button>
    <button class="filter-chip" onclick="filtrele('moored',this)">âš“ Demirli</button>
    <button class="filter-chip" onclick="filtrele('rotada',this)">ğŸ¯ Rotada</button>
  </div>

  <!-- GEMÄ° LÄ°STESÄ° -->
  <div id="gemiListesi">
    <div class="empty-state">
      <span class="big">ğŸŒŠ</span>
      RotayÄ± seÃ§ ve baÅŸlat<br>GerÃ§ek gemiler akacak
    </div>
  </div>

  <div class="footer">
    KAYNAK: AISStream.io Â· GERÃ‡EK ZAMANLI AIS<br>
    SON GÃœNCELLEME: <span id="guncellemeZamani">â€”</span>
  </div>
</div>

<script>
// â”€â”€â”€ SABÄ°TLER â”€â”€â”€
const API_KEY = 'ea8b26c488a02ed5d889154ce62c2cd3c63bf226';

// Ãœlke bounding box'larÄ± [SW_lat, SW_lon], [NE_lat, NE_lon]
const ULKE_BBOX = {
  TR: [[35.8,25.6],[42.1,44.8]],
  AE: [[22.6,51.0],[26.1,56.4]],
  SA: [[16.0,34.5],[32.0,55.7]],
  CN: [[18.0,108.0],[53.0,135.0]],
  JP: [[24.0,122.0],[46.0,146.0]],
  KR: [[33.0,124.0],[38.5,130.0]],
  SG: [[1.1,103.5],[1.5,104.1]],
  IN: [[6.0,68.0],[37.0,97.0]],
  PK: [[23.0,60.0],[37.0,77.0]],
  MY: [[1.0,99.5],[7.5,119.0]],
  ID: [[-8.5,95.0],[6.0,141.0]],
  DE: [[53.0,6.5],[55.1,15.0]],
  NL: [[51.2,3.2],[53.6,7.2]],
  BE: [[50.7,2.5],[51.5,5.9]],
  GB: [[49.9,-8.0],[60.9,2.0]],
  IT: [[37.0,6.6],[47.1,18.5]],
  ES: [[35.9,-9.3],[43.8,4.3]],
  GR: [[34.8,19.4],[42.0,28.2]],
  FR: [[41.3,-5.2],[51.1,9.7]],
  US: [[24.0,-125.0],[50.0,-65.0]],
  BR: [[-33.7,-73.0],[5.3,-28.0]],
  AU: [[-43.6,113.0],[-10.0,154.0]],
  EG: [[22.0,24.7],[31.7,37.0]],
  ZA: [[-35.0,16.3],[-22.1,33.0]],
  KW: [[28.5,47.0],[30.1,48.5]],
  QA: [[24.5,50.5],[26.3,51.7]],
  OM: [[16.5,51.8],[26.4,59.8]],
  IR: [[25.0,44.0],[39.8,63.3]],
  IQ: [[29.0,46.0],[37.5,48.7]],
};

// Liman bounding box'larÄ±
const LIMAN_BBOX = {
  TRAMS:[[40.9,28.5],[41.2,29.0]], TRMER:[[36.5,34.3],[36.9,34.8]],
  TRALP:[[38.6,26.8],[38.9,27.1]], TRISK:[[36.4,36.0],[36.7,36.4]],
  TRTBS:[[40.9,39.5],[41.1,39.9]], AEJEA:[[24.8,54.9],[25.2,55.3]],
  AEAUH:[[24.3,54.2],[24.7,54.6]], AESHJ:[[25.2,55.2],[25.5,55.6]],
  SADMM:[[26.2,49.9],[26.6,50.3]], SAJED:[[21.3,39.0],[21.7,39.4]],
  SAYNB:[[23.9,37.9],[24.3,38.3]], KWKWI:[[29.2,47.8],[29.6,48.2]],
  QAHMD:[[24.8,51.4],[25.2,51.8]], OMSOH:[[16.8,53.8],[17.2,54.2]],
  OMMCT:[[23.4,58.3],[23.8,58.7]], CNSHA:[[30.7,121.2],[31.6,122.1]],
  HKHKG:[[22.1,113.9],[22.5,114.4]], CNTAO:[[35.9,120.1],[36.4,120.6]],
  CNTSN:[[38.8,117.5],[39.3,118.0]], CNNGB:[[29.7,121.4],[30.2,121.9]],
  CNSZX:[[22.4,113.7],[22.9,114.2]], SGSIN:[[1.1,103.6],[1.5,104.1]],
  MYPKG:[[2.8,101.1],[3.2,101.5]], IDJKT:[[-6.3,106.6],[-5.8,107.1]],
  INNSA:[[18.8,72.7],[19.3,73.2]], INMAA:[[12.8,80.0],[13.3,80.5]],
  INMUN:[[22.5,69.8],[23.0,70.3]], DEHAM:[[53.3,9.7],[53.8,10.2]],
  NLRTM:[[51.7,4.0],[52.2,4.5]], BEANR:[[51.0,4.2],[51.5,4.7]],
  GRPIR:[[37.7,23.4],[38.2,23.9]], ITGOA:[[44.1,8.7],[44.6,9.2]],
  PKKAR:[[24.6,66.8],[25.0,67.3]], EGPSD:[[31.1,32.1],[31.5,32.5]],
  EGALX:[[30.9,29.7],[31.4,30.2]], ZADUR:[[-30.0,30.8],[-29.5,31.3]],
};

// VarÄ±ÅŸ limanÄ± keyword eÅŸleÅŸtirme
const VARIS_KEYWORDS = {
  AE: ['JEBEL ALI','DUBAI','ABU DHABI','SHARJAH','ZAYED','RUWAIS','UAE','AEJEA','AEAUH'],
  SA: ['DAMMAM','JEDDAH','YANBU','JUBAIL','JIZAN','SAUDI'],
  TR: ['ISTANBUL','MERSIN','IZMIR','AMBARI','ISKENDERUN','TRABZON','SAMSUN','TURKEY','TURKIYE'],
  CN: ['SHANGHAI','QINGDAO','TIANJIN','GUANGZHOU','NINGBO','SHENZHEN','DALIAN','XIAMEN','CHINA'],
  JP: ['TOKYO','YOKOHAMA','OSAKA','NAGOYA','KOBE','JAPAN'],
  KR: ['BUSAN','INCHEON','GWANGYANG','KOREA'],
  SG: ['SINGAPORE','SINGAPOUR'],
  IN: ['MUMBAI','NHAVA SHEVA','JNPT','CHENNAI','MUNDRA','INDIA','KANDLA'],
  DE: ['HAMBURG','GERMANY'],
  NL: ['ROTTERDAM','AMSTERDAM'],
  GB: ['FELIXSTOWE','SOUTHAMPTON','LONDON'],
  IT: ['GENOVA','GENOA','TRIESTE','NAPOLI','NAPLES'],
  GR: ['PIRAEUS','PIREUS','THESSALONIKI'],
  KW: ['KUWAIT','SHUAIBA'],
  QA: ['HAMAD','DOHA','QATAR'],
  OM: ['SALALAH','MUSCAT','SOHAR'],
  EG: ['PORT SAID','ALEXANDRIA','DAMIETTA','EGYPT','SUEZ'],
  AEJEA: ['JEBEL ALI','DUBAI','JEBEL'],
  AEAUH: ['ABU DHABI','ZAYED'],
  AESHJ: ['SHARJAH'],
  OMSOH: ['SALALAH'],
  TRAMS: ['AMBARLI','ISTANBUL','AMBARI'],
  TRMER: ['MERSIN'],
};

let ws = null;
let gemiler = {};
let aktifFiltre = 'all';
let aktifKart = null;
let aktifTab = 'ulke';
let rotaHedef = {};

function tabDegis(tab, el) {
  aktifTab = tab;
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('tab-' + tab).classList.add('active');
}

function baglan() {
  let cikisKod, varisKod, bbox1, bbox2;

  if (aktifTab === 'ulke') {
    cikisKod = document.getElementById('cikisUlke').value;
    varisKod = document.getElementById('varisUlke').value;
    if (cikisKod === varisKod) { alert('Ã‡Ä±kÄ±ÅŸ ve varÄ±ÅŸ farklÄ± olmalÄ±!'); return; }
    bbox1 = ULKE_BBOX[cikisKod];
    bbox2 = ULKE_BBOX[varisKod];
  } else {
    cikisKod = document.getElementById('cikisLiman').value;
    varisKod = document.getElementById('varisLiman').value;
    bbox1 = LIMAN_BBOX[cikisKod];
    bbox2 = LIMAN_BBOX[varisKod];
  }

  if (!bbox1 || !bbox2) { alert('Bu rota iÃ§in koordinat bulunamadÄ±!'); return; }

  rotaHedef = { cikis: cikisKod, varis: varisKod };
  gemiler = {};

  // Bounding box listesi â€” Ã§Ä±kÄ±ÅŸ + varÄ±ÅŸ + gÃ¼zergah bÃ¶lgeleri
  const boundingBoxes = [bbox1, bbox2];

  // GÃ¼zergah mantÄ±ÄŸÄ± â€” araya geÃ§iÅŸ bÃ¶lgeleri ekle
  const guzergah = guzergahBul(cikisKod, varisKod);
  guzergah.forEach(bb => boundingBoxes.push(bb));

  document.getElementById('baglanBtn').style.display = 'none';
  document.getElementById('kesBtn').style.display = 'block';
  document.getElementById('connBar').style.display = 'flex';
  document.getElementById('statsBar').style.display = 'flex';
  document.getElementById('filterBar').style.display = 'flex';

  log(`BaÄŸlantÄ± baÅŸlÄ±yor: ${cikisKod} â†’ ${varisKod}`, 'info');
  log(`${boundingBoxes.length} bÃ¶lge izlenecek`, 'info');

  ws = new WebSocket('wss://stream.aisstream.io/v0/stream');

  ws.onopen = () => {
    document.getElementById('connTitle').textContent = 'BaÄŸlÄ± â€” Veri AkÄ±yor';
    document.getElementById('connSub').textContent = `${cikisKod} â†’ ${varisKod} Â· ${boundingBoxes.length} bÃ¶lge`;
    log('âœ“ WebSocket baÄŸlandÄ±', 'ok');

    // TÃ¼rkiye-Dubai iÃ§in tÃ¼m gÃ¼zergahÄ± kapsayan tek bÃ¼yÃ¼k bbox gÃ¶nder
    // Bu daha gÃ¼venilir Ã§alÄ±ÅŸÄ±yor
    const abonelik = {
      APIKey: API_KEY,
      BoundingBoxes: boundingBoxes,
      FilterMessageTypes: ["PositionReport", "ShipStaticData"]
    };

    log(`ğŸ“¡ ${boundingBoxes.length} bÃ¶lge, abonelik gÃ¶nderiliyor...`, 'info');
    ws.send(JSON.stringify(abonelik));
  };

  ws.onmessage = (event) => {
    try {
      const data = JSON.parse(event.data);

      // API hata mesajÄ± mÄ±?
      if (data.error) {
        log(`âŒ API HatasÄ±: ${data.error}`, 'err');
        return;
      }
      if (data.message) {
        log(`âš ï¸ API: ${data.message}`, 'warn');
        return;
      }

      // Ä°lk mesajlarÄ± logla
      if (!window._mc) window._mc = 0;
      if (window._mc < 5) {
        log(`ğŸ“¦ ${data.MessageType || JSON.stringify(data).slice(0,80)}`, 'ok');
        window._mc++;
      }

      islemYap(data);
    } catch(e) {
      log(`Parse hatasÄ±: ${e.message}`, 'err');
    }
  };

  ws.onerror = (e) => {
    log('âŒ WebSocket baÄŸlantÄ± hatasÄ±!', 'err');
    log('TarayÄ±cÄ± konsolunu kontrol et (F12)', 'warn');
    document.getElementById('connTitle').textContent = 'BaÄŸlantÄ± HatasÄ±';
  };

  ws.onclose = (e) => {
    log(`BaÄŸlantÄ± kapandÄ± (kod: ${e.code})`, 'err');
    if (e.code === 1008) log('âŒ API anahtarÄ± geÃ§ersiz!', 'err');
    document.getElementById('connTitle').textContent = 'BaÄŸlantÄ± Kesildi';
    // Otomatik yeniden baÄŸlan (5 saniye sonra)
    setTimeout(() => {
      if (document.getElementById('kesBtn').style.display !== 'none') {
        log('ğŸ”„ Yeniden baÄŸlanÄ±yor...', 'info');
        baglan();
      }
    }, 5000);
  };
}

function islemYap(data) {
  const msgType = data.MessageType;
  const maxGemi = parseInt(document.getElementById('maxGemi').value);
  const gemiTipi = document.getElementById('gemiTipi').value;

  if (msgType === 'PositionReport') {
    const msg = data.Message?.PositionReport;
    const meta = data.MetaData;
    if (!msg || !meta) return;

    const mmsi = String(meta.MMSI || meta.MMSI_String || '');
    if (!mmsi) return;

    const hiz = parseFloat(msg.Sog || 0).toFixed(1);
    const nav = msg.NavigationalStatus ?? 0;
    const durum = (nav === 1 || nav === 5) ? 'moored' : 'underway';

    if (gemiler[mmsi]) {
      // Mevcut gemiyi gÃ¼ncelle
      gemiler[mmsi].hiz = hiz;
      gemiler[mmsi].durum = durum;
      gemiler[mmsi].lat = parseFloat(msg.Latitude || meta.latitude || 0).toFixed(4);
      gemiler[mmsi].lon = parseFloat(msg.Longitude || meta.longitude || 0).toFixed(4);
      gemiler[mmsi].sonGuncelleme = new Date();
    } else {
      // Yeni gemi ekle
      if (Object.keys(gemiler).length >= maxGemi) return;

      const gemAd = (meta.ShipName || '').trim() || `GEMÄ°-${mmsi.slice(-4)}`;

      gemiler[mmsi] = {
        mmsi,
        ad: gemAd,
        imo: '-',
        bayrak: '',
        tip: '-',
        hiz, durum,
        hedef: '-',
        lat: parseFloat(msg.Latitude || meta.latitude || 0).toFixed(4),
        lon: parseFloat(msg.Longitude || meta.longitude || 0).toFixed(4),
        eklenme: new Date(),
        sonGuncelleme: new Date(),
        yeni: true,
        rotada: false,
        shipTypeCode: 0,
      };

      setTimeout(() => { if (gemiler[mmsi]) gemiler[mmsi].yeni = false; }, 30000);
      log(`ğŸš¢ ${gemAd} (${mmsi})`, 'ok');
    }

    listeGuncelle();
  }

  if (msgType === 'ShipStaticData') {
    const msg = data.Message?.ShipStaticData;
    const meta = data.MetaData;
    if (!msg || !meta) return;

    const mmsi = String(meta.MMSI || meta.MMSI_String || '');
    if (!gemiler[mmsi]) return;

    const hedef = (msg.Destination || '').trim().toUpperCase();
    const shipTypeCode = msg.Type || 0;
    const tipAdi = shipTipAdi(shipTypeCode);

    gemiler[mmsi].imo = msg.ImoNumber ? String(msg.ImoNumber) : '-';
    gemiler[mmsi].ad = (msg.Name || '').trim() || gemiler[mmsi].ad;
    gemiler[mmsi].hedef = hedef || '-';
    gemiler[mmsi].bayrak = bayrakEmoji(msg.CountryCode || '');
    gemiler[mmsi].tip = tipAdi;
    gemiler[mmsi].shipTypeCode = shipTypeCode;
    gemiler[mmsi].dwt = msg.Draught ? `${msg.Draught}m` : '-';

    // Gemi tipi filtresi
    const seciliTip = document.getElementById('gemiTipi').value;
    if (seciliTip === 'bulk' && !(shipTypeCode >= 70 && shipTypeCode <= 79)) {
      delete gemiler[mmsi]; return;
    }
    if (seciliTip === 'tanker' && !(shipTypeCode >= 80 && shipTypeCode <= 89)) {
      delete gemiler[mmsi]; return;
    }

    // Rotada mÄ± kontrol et
    if (hedef) {
      gemiler[mmsi].rotada = rotaKontrol(hedef, rotaHedef.varis);
    }

    listeGuncelle();
  }
}

function guzergahBul(cikis, varis) {
  // YaygÄ±n gÃ¼zergahlar iÃ§in ara bÃ¶lgeler
  const araBoxlar = [];
  const cift = `${cikis}-${varis}`;

  // TÃ¼rkiye â†” KÃ¶rfez (SÃ¼veyÅŸ / KÄ±zÄ±ldeniz gÃ¼zergahÄ±)
  if (['TR-AE','TR-SA','TR-KW','TR-QA','TR-OM','TR-IR','TR-IQ',
       'AE-TR','SA-TR','KW-TR','QA-TR'].includes(cift)) {
    araBoxlar.push([[10.0,32.0],[32.0,44.0]]); // KÄ±zÄ±ldeniz
    araBoxlar.push([[10.0,44.0],[25.0,60.0]]); // Arabistan Denizi / KÃ¶rfez
  }
  // Avrupa â†” KÃ¶rfez
  if (['DE-AE','NL-AE','GB-AE','IT-AE','GR-AE','FR-AE','ES-AE',
       'AE-DE','AE-NL','AE-GB','AE-IT','AE-GR'].includes(cift) ||
      cikis === 'CN' && ['AE','SA','KW','QA'].includes(varis) ||
      varis === 'CN' && ['AE','SA','KW','QA'].includes(cikis)) {
    araBoxlar.push([[10.0,32.0],[30.0,44.0]]); // KÄ±zÄ±ldeniz
    araBoxlar.push([[0.0,44.0],[25.0,65.0]]);  // Arabistan Denizi
  }
  // Asya â†” KÃ¶rfez (Hint Okyanusu)
  if (['SG-AE','IN-AE','MY-AE','ID-AE','CN-AE','JP-AE','KR-AE',
       'AE-SG','AE-IN','AE-MY','AE-CN'].includes(cift)) {
    araBoxlar.push([[-5.0,55.0],[20.0,80.0]]); // Hint Okyanusu
    araBoxlar.push([[5.0,50.0],[25.0,65.0]]);   // Arabistan Denizi
  }
  // SÃ¼veyÅŸ KanalÄ± geÃ§iÅŸi
  if (cikis === 'EG' || varis === 'EG') {
    araBoxlar.push([[25.0,30.0],[33.0,37.0]]); // SÃ¼veyÅŸ
  }

  return araBoxlar;
}

function rotaKontrol(hedef, varisKod) {
  if (!hedef || hedef === '-') return false;
  const keywords = VARIS_KEYWORDS[varisKod] || [varisKod];
  return keywords.some(k => hedef.includes(k));
}

function listeGuncelle() {
  const tumGemiler = Object.values(gemiler);
  const hareket = tumGemiler.filter(g => g.durum === 'underway').length;
  const durgun = tumGemiler.filter(g => g.durum === 'moored').length;
  const rotada = tumGemiler.filter(g => g.rotada).length;

  document.getElementById('toplamSayi').textContent = tumGemiler.length;
  document.getElementById('hareketSayi').textContent = hareket;
  document.getElementById('durgunSayi').textContent = durgun;
  document.getElementById('rotadaSayi').textContent = rotada;
  document.getElementById('connCount').textContent = tumGemiler.length;
  document.getElementById('guncellemeZamani').textContent = new Date().toLocaleTimeString('tr-TR');

  let gosterilen = tumGemiler;
  if (aktifFiltre === 'underway') gosterilen = tumGemiler.filter(g => g.durum === 'underway');
  else if (aktifFiltre === 'moored') gosterilen = tumGemiler.filter(g => g.durum === 'moored');
  else if (aktifFiltre === 'rotada') gosterilen = tumGemiler.filter(g => g.rotada);

  // SÄ±rala: rotadakiler Ã¼ste, sonra hÄ±za gÃ¶re
  gosterilen.sort((a,b) => {
    if (b.rotada !== a.rotada) return (b.rotada ? 1 : 0) - (a.rotada ? 1 : 0);
    return parseFloat(b.hiz) - parseFloat(a.hiz);
  });

  const liste = document.getElementById('gemiListesi');

  gosterilen.slice(0, 100).forEach(g => {
    const varEl = document.getElementById('kart_' + g.mmsi);
    if (varEl) {
      // GÃ¼ncelle
      const hizEl = varEl.querySelector('.hiz-val');
      const db = varEl.querySelector('.durum-badge');
      const hedefEl = varEl.querySelector('.hedef-val');
      if (hizEl) hizEl.textContent = g.hiz + ' knot';
      if (db) {
        db.className = 'badge durum-badge ' + (g.durum === 'underway' ? 'badge-move' : 'badge-stop');
        db.textContent = g.durum === 'underway' ? 'âš¡ Hareket' : 'âš“ Demirli';
      }
      if (hedefEl && g.hedef !== '-') hedefEl.textContent = 'ğŸ ' + g.hedef;
    } else {
      // Yeni kart
      const kart = kartOlustur(g);
      liste.insertBefore(kart, liste.firstChild);
      while (liste.children.length > 100) liste.removeChild(liste.lastChild);
    }
  });

  if (gosterilen.length === 0 && tumGemiler.length > 0) {
    liste.innerHTML = '<div class="empty-state"><span class="big">ğŸ”</span>Bu filtre iÃ§in gemi yok</div>';
  } else if (tumGemiler.length === 0) {
    liste.innerHTML = '<div class="empty-state"><span class="big">â³</span>AIS sinyalleri bekleniyor...<br>Ä°lk gemiler 10-30 saniye iÃ§inde gelir</div>';
  }
}

function kartOlustur(g) {
  const kart = document.createElement('div');
  let cls = 'ship-card';
  if (g.yeni) cls += ' yeni';
  if (g.rotada) cls += ' rotada-kart';
  kart.className = cls;
  kart.id = 'kart_' + g.mmsi;

  kart.innerHTML = `
    <div class="ship-top">
      <div>
        <div class="ship-name">${g.bayrak} ${g.ad}</div>
        <div class="ship-mmsi">MMSI: ${g.mmsi}${g.imo !== '-' ? ' Â· IMO: ' + g.imo : ''}</div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:4px">
        ${g.yeni ? '<span class="badge badge-new">ğŸ†•</span>' : ''}
        ${g.rotada ? '<span class="badge badge-rotada">ğŸ¯ ROTADA</span>' : ''}
      </div>
    </div>
    <div class="ship-meta">
      <span class="badge badge-bulk">âš™ï¸ ${g.tip || '?'}</span>
      <span class="badge durum-badge ${g.durum === 'underway' ? 'badge-move' : 'badge-stop'}">${g.durum === 'underway' ? 'âš¡ Hareket' : 'âš“ Demirli'}</span>
      <span class="badge badge-bulk hiz-val">${g.hiz} kn</span>
    </div>
    <div class="route-display">
      <span class="port">ğŸ“ ${g.lat}Â°, ${g.lon}Â°</span>
      <span class="arrow"> â†’ </span>
      <span class="port hedef-val">ğŸ ${g.hedef}</span>
    </div>
    <div class="ship-details">
      <div class="detail-row"><span class="detail-key">ğŸš€ HÄ±z</span><span class="detail-val hiz-val">${g.hiz} knot</span></div>
      <div class="detail-row"><span class="detail-key">ğŸ“ Konum</span><span class="detail-val">${g.lat}Â°, ${g.lon}Â°</span></div>
      <div class="detail-row"><span class="detail-key">ğŸ Hedef</span><span class="detail-val">${g.hedef}</span></div>
      <div class="detail-row"><span class="detail-key">âš“ Tip</span><span class="detail-val">${g.tip}</span></div>
      <div class="detail-row"><span class="detail-key">ğŸ• Ä°lk GÃ¶rÃ¼lme</span><span class="detail-val">${g.eklenme.toLocaleTimeString('tr-TR')}</span></div>
      <div class="detail-row"><span class="detail-key">ğŸ—ºï¸ Harita</span><span class="detail-val detail-link" onclick="haritaAc('${g.mmsi}')">MarineTraffic â†’</span></div>
    </div>
  `;

  kart.onclick = (e) => {
    if (e.target.classList.contains('detail-link')) return;
    if (aktifKart && aktifKart !== kart) aktifKart.classList.remove('expanded');
    kart.classList.toggle('expanded');
    aktifKart = kart.classList.contains('expanded') ? kart : null;
  };
  return kart;
}

function filtrele(tip, el) {
  aktifFiltre = tip;
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('gemiListesi').innerHTML = '';
  listeGuncelle();
}

function baglantiKes() {
  if (ws) ws.close();
  document.getElementById('baglanBtn').style.display = 'block';
  document.getElementById('kesBtn').style.display = 'none';
  document.getElementById('connTitle').textContent = 'BaÄŸlantÄ± Kesildi';
  log('BaÄŸlantÄ± manuel kesildi', 'err');
}

function haritaAc(mmsi) {
  window.open(`https://www.marinetraffic.com/en/ais/details/ships/mmsi:${mmsi}`, '_blank');
}

function shipTipAdi(t) {
  if (t >= 70 && t <= 79) return 'Bulk Carrier';
  if (t >= 80 && t <= 89) return 'Tanker';
  if (t === 70) return 'Kargo';
  if (t >= 60 && t <= 69) return 'Yolcu';
  if (t === 30) return 'BalÄ±kÃ§Ä±';
  if (t >= 40 && t <= 49) return 'HSC';
  if (t >= 50 && t <= 59) return 'Ã–zel';
  return t > 0 ? `Tip-${t}` : 'Bilinmiyor';
}

function bayrakEmoji(cc) {
  const b = {
    PA:'ğŸ‡µğŸ‡¦',CN:'ğŸ‡¨ğŸ‡³',HK:'ğŸ‡­ğŸ‡°',SG:'ğŸ‡¸ğŸ‡¬',GR:'ğŸ‡¬ğŸ‡·',MT:'ğŸ‡²ğŸ‡¹',LR:'ğŸ‡±ğŸ‡·',
    MH:'ğŸ‡²ğŸ‡­',CY:'ğŸ‡¨ğŸ‡¾',BS:'ğŸ‡§ğŸ‡¸',AE:'ğŸ‡¦ğŸ‡ª',TR:'ğŸ‡¹ğŸ‡·',DE:'ğŸ‡©ğŸ‡ª',NL:'ğŸ‡³ğŸ‡±',
    GB:'ğŸ‡¬ğŸ‡§',US:'ğŸ‡ºğŸ‡¸',JP:'ğŸ‡¯ğŸ‡µ',KR:'ğŸ‡°ğŸ‡·',IN:'ğŸ‡®ğŸ‡³',IT:'ğŸ‡®ğŸ‡¹',NO:'ğŸ‡³ğŸ‡´',
    DK:'ğŸ‡©ğŸ‡°',VN:'ğŸ‡»ğŸ‡³',MY:'ğŸ‡²ğŸ‡¾',ID:'ğŸ‡®ğŸ‡©',PH:'ğŸ‡µğŸ‡­',TH:'ğŸ‡¹ğŸ‡­',BD:'ğŸ‡§ğŸ‡©',
    PK:'ğŸ‡µğŸ‡°',IR:'ğŸ‡®ğŸ‡·',SA:'ğŸ‡¸ğŸ‡¦',KW:'ğŸ‡°ğŸ‡¼',QA:'ğŸ‡¶ğŸ‡¦',OM:'ğŸ‡´ğŸ‡²',EG:'ğŸ‡ªğŸ‡¬',
    RU:'ğŸ‡·ğŸ‡º',UA:'ğŸ‡ºğŸ‡¦',FR:'ğŸ‡«ğŸ‡·',ES:'ğŸ‡ªğŸ‡¸',PT:'ğŸ‡µğŸ‡¹',BE:'ğŸ‡§ğŸ‡ª',
  };
  return b[cc] || '';
}

function log(msg, tip = 'info') {
  const box = document.getElementById('logBox');
  box.style.display = 'block';
  const el = document.createElement('div');
  el.className = 'log-line ' + tip;
  el.textContent = `[${new Date().toLocaleTimeString('tr-TR')}] ${msg}`;
  box.insertBefore(el, box.firstChild);
  if (box.children.length > 20) box.removeChild(box.lastChild);
}
</script>
</body>
</html>
